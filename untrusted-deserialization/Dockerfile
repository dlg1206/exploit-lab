# Build demo jar
FROM maven:3.9.6-eclipse-temurin-17-alpine AS build

WORKDIR /home/maven
COPY pom.xml .
COPY src src

RUN mvn package

# Launch demo
FROM openjdk:17-jdk-slim AS start

EXPOSE 8080

# copy and launch demo
WORKDIR /app
COPY --from=build /home/maven/target/untrusted-deserialization-1.0.0.jar demo-1.0.0.jar

# Demo malious code
# Creates a script that infinitely increments and kills processes
RUN echo '#!/bin/bash' > my-super-hax.sh; echo 'i=0;while :;do kill $i; i=$((i+1));done' >> my-super-hax.sh
RUN chmod +x my-super-hax.sh

ENTRYPOINT ["java", "-jar", "demo-1.0.0.jar"]