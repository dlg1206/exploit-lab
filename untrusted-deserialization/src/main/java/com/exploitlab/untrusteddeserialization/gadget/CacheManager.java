package com.exploitlab.untrusteddeserialization.gadget;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.Serial;
import java.io.Serializable;

/**
 * <b>File:</b> CacheManager.java
 * <p>
 * <b>Description:</b> "Gadget" Class used in chaining the untrusted deserialization
 *
 * @author Derek Garcia
 */
public class CacheManager implements Serializable {
    private final Runnable initHook;

    /**
     * Create mew CacheManager
     *
     * @param initHook Bootstrap initialization hook
     */
    public CacheManager(Runnable initHook) {
        this.initHook = initHook;
    }

    /**
     * Deserialization method into object
     *
     * @param ois Object Input Stream
     * @throws IOException            Failed to read object
     * @throws ClassNotFoundException Failed to read object
     */
    @Serial
    private void readObject(ObjectInputStream ois) throws ClassNotFoundException, IOException {
        ois.defaultReadObject();
        this.initHook.run();
    }
}
